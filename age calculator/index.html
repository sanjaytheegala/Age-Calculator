<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Life Counter</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div id="mainCard" class="bg-white/80 backdrop-blur-sm shadow-2xl rounded-2xl p-4 sm:p-6 w-full max-w-md border border-gray-100 transition-transform hover:-translate-y-1">
    <div class="flex items-center space-x-3 mb-4">
      <div>
        <h1 class="text-xl sm:text-2xl font-bold">Life Counter</h1>
        <div class="text-xs text-gray-500">Live age in <span id="typewriter" class="font-semibold text-blue-600"></span></div>
      </div>
    </div>
    <div class="mb-6">
      <div class="border-t border-gray-100 -mx-4 sm:-mx-6 mb-6"></div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Enter Your Birth Date</label>
      <div class="grid grid-cols-3 gap-2">
        <div class="flex flex-col justify-start">
          <label for="birthDay" class="text-xs text-gray-500">Day</label>
          <input type="number" id="birthDay" min="1" max="31" placeholder="DD" class="w-full px-2 h-10 leading-6 items-center border rounded focus:outline-none focus:ring focus:border-blue-300 text-sm" />
        </div>
        <div class="flex flex-col justify-start">
          <label for="birthMonth" class="text-xs text-gray-500">Month</label>
          <select id="birthMonth" class="w-full px-2 h-10 leading-6 items-center border rounded focus:outline-none focus:ring focus:border-blue-300 text-sm">
            <option value="" disabled>Month</option>
            <option value="1">January</option>
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
            <option value="5">May</option>
            <option value="6">June</option>
            <option value="7">July</option>
            <option value="8">August</option>
            <option value="9">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
          </select>
        </div>
        <div class="flex flex-col justify-start">
          <label for="birthYear" class="text-xs text-gray-500">Year</label>
          <input type="number" id="birthYear" min="1900" max="9999" placeholder="YYYY" class="w-full px-2 h-10 leading-6 items-center border rounded focus:outline-none focus:ring focus:border-blue-300 text-sm" />
        </div>
      </div>
    </div>
    <button id="saveBtn" class="w-full inline-flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-2 rounded-full hover:shadow-lg transition mb-4">
      <svg id="loadingSpinner" class="hidden animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <span id="buttonText">Start Counting</span>
    </button>
  <div id="messageBox" class="mb-4 text-center text-sm text-gray-600"></div>
    <div id="counterBox" class="space-y-2">
      <div class="font-semibold">Standard Age:</div>
      <div id="standardAge" class="text-base sm:text-lg"></div>
      <div class="grid grid-cols-3 gap-2 mt-2 text-center">
        <div class="p-2 sm:p-3 bg-white/60 shadow-sm rounded-lg">
          <div class="text-xs text-gray-500">Years</div>
          <div id="yearsLabel" class="text-base sm:text-lg font-semibold">--</div>
        </div>
        <div class="p-2 sm:p-3 bg-white/60 shadow-sm rounded-lg">
          <div class="text-xs text-gray-500">Months</div>
          <div id="monthsLabel" class="text-base sm:text-lg font-semibold">--</div>
        </div>
        <div class="p-2 sm:p-3 bg-white/60 shadow-sm rounded-lg">
          <div class="text-xs text-gray-500">Days</div>
          <div id="daysLabel" class="text-base sm:text-lg font-semibold">--</div>
        </div>
      </div>
      <div class="font-semibold mt-2">Total Metrics:</div>
      <div id="totalMetrics" class="text-sm"></div>
    </div>
  </div>
  <script>
    'use strict';
    
    const state = {
      birthDateStr: null,
      counterInterval: null,
      typewriterInterval: null,
      isProcessing: false
    };

    const elements = {
      birthDayInput: document.getElementById('birthDay'),
      birthMonthInput: document.getElementById('birthMonth'),
      birthYearInput: document.getElementById('birthYear'),
      saveBtn: document.getElementById('saveBtn'),
      buttonText: document.getElementById('buttonText'),
      loadingSpinner: document.getElementById('loadingSpinner'),
      messageBox: document.getElementById('messageBox'),
      standardAge: document.getElementById('standardAge'),
      totalMetrics: document.getElementById('totalMetrics'),
      yearsLabel: document.getElementById('yearsLabel'),
      monthsLabel: document.getElementById('monthsLabel'),
      daysLabel: document.getElementById('daysLabel'),
      typewriter: document.getElementById('typewriter')
    };

    const typewriterConfig = {
      words: ['years', 'months', 'days', 'hours', 'minutes'],
      wordIndex: 0,
      charIndex: 0,
      isDeleting: false,
      typingSpeed: 100,
      deletingSpeed: 50,
      pauseDuration: 1500
    };

    function typeWriterEffect() {
      const { words, wordIndex, charIndex, isDeleting } = typewriterConfig;
      const currentWord = words[wordIndex];
      
      if (!isDeleting) {
        elements.typewriter.textContent = currentWord.substring(0, charIndex + 1);
        typewriterConfig.charIndex++;
        
        if (typewriterConfig.charIndex === currentWord.length) {
          setTimeout(() => { 
            typewriterConfig.isDeleting = true; 
          }, typewriterConfig.pauseDuration);
          return;
        }
      } else {
        elements.typewriter.textContent = currentWord.substring(0, charIndex - 1);
        typewriterConfig.charIndex--;
        
        if (typewriterConfig.charIndex === 0) {
          typewriterConfig.isDeleting = false;
          typewriterConfig.wordIndex = (wordIndex + 1) % words.length;
        }
      }
    }

    function startTypewriter() {
      if (state.typewriterInterval) {
        clearInterval(state.typewriterInterval);
      }
      
      state.typewriterInterval = setInterval(() => {
        typeWriterEffect();
      }, typewriterConfig.isDeleting ? typewriterConfig.deletingSpeed : typewriterConfig.typingSpeed);
    }

    function showMessage(msg, isError = false) {
      if (!elements.messageBox) return;
      
      elements.messageBox.textContent = msg;
      elements.messageBox.className = isError 
        ? 'mb-4 text-center text-sm text-red-700 bg-red-50 rounded py-2'
        : 'mb-4 text-center text-sm text-green-700 bg-green-50 rounded py-2';
      
      setTimeout(() => {
        elements.messageBox.textContent = '';
        elements.messageBox.className = 'mb-4 text-center text-sm text-gray-600';
      }, 5000);
    }

    function buildDateOnlyFromInputs() {
      const d = Number(elements.birthDayInput.value);
      const m = Number(elements.birthMonthInput.value);
      const y = Number(elements.birthYearInput.value);
      
      if (!y || !m || !d) return null;
      
      if (y < 1900 || y > new Date().getFullYear()) return null;
      if (m < 1 || m > 12) return null;
      if (d < 1 || d > 31) return null;
      
      const dt = new Date(y, m - 1, d);
      if (dt.getFullYear() !== y || dt.getMonth() !== m - 1 || dt.getDate() !== d) {
        return null;
      }
      
      if (dt > new Date()) return null;
      
      const mm = String(m).padStart(2, '0');
      const dd = String(d).padStart(2, '0');
      return `${y}-${mm}-${dd}`;
    }

    function calculateMetrics(birthDate) {
      try {
        const now = new Date();
        let years = now.getFullYear() - birthDate.getFullYear();
        let months = now.getMonth() - birthDate.getMonth();
        let days = now.getDate() - birthDate.getDate();
        
        if (days < 0) {
          months--;
          const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0);
          days += prevMonth.getDate();
        }
        
        if (months < 0) {
          years--;
          months += 12;
        }
        
        const msDiff = now - birthDate;
        const totalMinutes = Math.floor(msDiff / (1000 * 60));
        const totalHours = Math.floor(msDiff / (1000 * 60 * 60));
        const totalDays = Math.floor(msDiff / (1000 * 60 * 60 * 24));
        const totalWeeks = Math.floor(totalDays / 7);
        const totalMonths = Math.floor(totalDays / 30.4375);
        
        return {
          years: Math.max(0, years),
          months: Math.max(0, months),
          days: Math.max(0, days),
          totalMonths: Math.max(0, totalMonths),
          totalWeeks: Math.max(0, totalWeeks),
          totalDays: Math.max(0, totalDays),
          totalHours: Math.max(0, totalHours),
          totalMinutes: Math.max(0, totalMinutes)
        };
      } catch (error) {
        console.error('Error calculating metrics:', error);
        return {
          years: 0, months: 0, days: 0,
          totalMonths: 0, totalWeeks: 0, totalDays: 0,
          totalHours: 0, totalMinutes: 0
        };
      }
    }

    function renderMetrics(birthDate) {
      try {
        const m = calculateMetrics(birthDate);
        
        if (elements.standardAge) {
          elements.standardAge.textContent = `${m.years} years, ${m.months} months, ${m.days} days`;
        }
        
        if (elements.yearsLabel) elements.yearsLabel.textContent = String(m.years);
        if (elements.monthsLabel) elements.monthsLabel.textContent = String(m.months);
        if (elements.daysLabel) elements.daysLabel.textContent = String(m.days);
        
        if (elements.totalMetrics) {
          const formatNumber = (num) => num.toLocaleString();
          
          elements.totalMetrics.innerHTML = `
            <div>Total Months: <span class="font-semibold">${formatNumber(m.totalMonths)}</span></div>
            <div>Total Weeks: <span class="font-semibold">${formatNumber(m.totalWeeks)}</span></div>
            <div>Total Days: <span class="font-semibold">${formatNumber(m.totalDays)}</span></div>
            <div>Total Hours: <span class="font-semibold">${formatNumber(m.totalHours)}</span> <span class="text-xs text-gray-500">(${numberToWords(m.totalHours)})</span></div>
            <div>Total Minutes: <span class="font-semibold">${formatNumber(m.totalMinutes)}</span> <span class="text-xs text-gray-500">(${numberToWords(m.totalMinutes)})</span></div>
          `;
        }
      } catch (error) {
        console.error('Error rendering metrics:', error);
      }
    }

    function numberToWords(num) {
      if (typeof num !== 'number' || isNaN(num)) return '0';
      if (num < 1000) return num.toString();
      
      const units = ['', 'thousand', 'million', 'billion', 'trillion'];
      let unitIndex = 0;
      let n = num;
      
      while (n >= 1000 && unitIndex < units.length - 1) {
        n = n / 1000;
        unitIndex++;
      }
      
      return `${n.toFixed(1)} ${units[unitIndex]}`;
    }

    function parseDateOnlyToLocalMidnight(dateOnlyStr) {
      try {
        const [y, m, d] = dateOnlyStr.split('-').map(Number);
        return new Date(y, m - 1, d, 0, 0, 0, 0);
      } catch (error) {
        console.error('Error parsing date:', error);
        return new Date();
      }
    }

    function startCounter(birthDateInput) {
      if (state.counterInterval) {
        clearInterval(state.counterInterval);
      }
      
      try {
        const birthDate = (typeof birthDateInput === 'string')
          ? parseDateOnlyToLocalMidnight(birthDateInput)
          : new Date(birthDateInput);
        
        renderMetrics(birthDate);
        
        state.counterInterval = setInterval(() => {
          renderMetrics(birthDate);
        }, 1000);
      } catch (error) {
        console.error('Error starting counter:', error);
        showMessage('Error starting counter. Please try again.', true);
      }
    }

    function saveBirthday() {
      if (state.isProcessing) return;
      
      const built = buildDateOnlyFromInputs();
      if (!built) {
        showMessage('Please enter a valid date (DD/MM/YYYY).', true);
        return;
      }
      
      state.isProcessing = true;
      
      elements.buttonText.textContent = 'Calculating...';
      elements.loadingSpinner.classList.remove('hidden');
      elements.saveBtn.disabled = true;
      elements.saveBtn.classList.add('opacity-75', 'cursor-not-allowed');
      
      setTimeout(() => {
        state.birthDateStr = built;
        startCounter(built);
        
        elements.buttonText.textContent = 'Start Counting';
        elements.loadingSpinner.classList.add('hidden');
        elements.saveBtn.disabled = false;
        elements.saveBtn.classList.remove('opacity-75', 'cursor-not-allowed');
        state.isProcessing = false;
      }, 800);
    }

    function loadBirthday() {
      try {
        elements.birthYearInput.value = '2004';
        elements.birthMonthInput.value = '5';
        elements.birthDayInput.value = '8';
        state.birthDateStr = '2004-05-08';
        startCounter(state.birthDateStr);
      } catch (error) {
        console.error('Error loading birthday:', error);
      }
    }

    function init() {
      try {
        startTypewriter();
        loadBirthday();
        
        if (elements.saveBtn) {
          elements.saveBtn.addEventListener('click', saveBirthday);
        }
      } catch (error) {
        console.error('Initialization error:', error);
      }
    }

    window.addEventListener('beforeunload', () => {
      if (state.counterInterval) clearInterval(state.counterInterval);
      if (state.typewriterInterval) clearInterval(state.typewriterInterval);
    });

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
